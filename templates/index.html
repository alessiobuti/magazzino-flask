<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Gestione Magazzino</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { margin-top: 40px; }
        table { border-collapse: collapse; width: 80%; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        input[type=text], input[type=number], select { padding: 5px; margin: 2px; }
        button { padding: 5px 10px; margin: 2px; }
    </style>
</head>
<body>
<h1>Magazzino</h1>

<form action="{{ url_for('add_product') }}" method="POST">
    <input type="text" name="nome_prodotto" placeholder="Nome prodotto" required>
    <input type="number" name="quantita_prodotto" placeholder="Quantità" required>
    <button type="submit">Aggiungi Prodotto</button>
</form>

<h2>Prodotti in Magazzino</h2>
<table>
    <tr><th>Prodotto</th><th>Quantità</th><th>Modifica</th><th>Elimina</th></tr>
    {% for nome, quantita in prodotti.items() %}
    <tr>
        <td>{{ nome }}</td>
        <td>{{ quantita }}</td>
        <td>
            <form action="{{ url_for('update_product', nome=nome) }}" method="POST">
                <input type="number" name="nuova_quantita" placeholder="Nuova quantità" required>
                <button type="submit">Aggiorna</button>
            </form>
        </td>
        <td><a href="{{ url_for('delete_product', nome=nome) }}">Elimina</a></td>
    </tr>
    {% endfor %}
</table>

<h1>Prodotti Ordinati / Da Vendere</h1>
<form action="{{ url_for('add_order') }}" method="POST" id="orderForm">
    <input type="text" name="nome_persona" placeholder="Nome Cliente" required><br><br>

    <div id="prodottiContainer">
        <div class="prodottoRow">
            <select name="prodotti_ordine" required>
                {% for nome in prodotti %}
                    <option value="{{ nome }}">{{ nome }}</option>
                {% endfor %}
            </select>
            <input type="number" name="quantita" placeholder="Quantità" required>
            <input type="number" step="0.01" name="prezzo" placeholder="Prezzo" required>
            <button type="button" onclick="removeRow(this)">-</button>
        </div>
    </div>
    <button type="button" onclick="addRow()">Aggiungi altro prodotto</button><br><br>
    <button type="submit">Crea Ordine</button>
</form>

<h2>Ordini</h2>
<table>
    <tr><th>Cliente</th><th>Prodotto</th><th>Quantità</th><th>Prezzo unitario</th><th>Totale</th></tr>
    {% for cliente, items in ordini.items() %}
        {% for item in items %}
        <tr>
            <td>{{ cliente }}</td>
            <td>{{ item.prodotto }}</td>
            <td>{{ item.quantita }}</td>
            <td>{{ item.prezzo }}</td>
            <td>{{ item.quantita * item.prezzo }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td colspan="5"><a href="{{ url_for('delete_order', nome_persona=cliente) }}">Elimina ordine di {{ cliente }}</a></td>
        </tr>
    {% endfor %}
</table>

<h3>Valore totale ordini: {{ totale_valore }}</h3>

<script>
function addRow() {
    const container = document.getElementById("prodottiContainer");
    const newRow = document.createElement("div");
    newRow.classList.add("prodottoRow");
    newRow.innerHTML = `
        <select name="prodotti_ordine" required>
            {% for nome in prodotti %}
                <option value="{{ nome }}">{{ nome }}</option>
            {% endfor %}
        </select>
        <input type="number" name="quantita" placeholder="Quantità" required>
        <input type="number" step="0.01" name="prezzo" placeholder="Prezzo" required>
        <button type="button" onclick="removeRow(this)">-</button>
    `;
    container.appendChild(newRow);
}

function removeRow(button) {
    button.parentElement.remove();
}
</script>
</body>
</html>
